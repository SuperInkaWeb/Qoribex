---
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import { Image } from 'astro:assets';
import '../../styles/home.css';

import logoWa from '../../assets/logos/logo-whatsapp.png';

// NOTA PARA EL USUARIO:
// Asegúrate de que tus videos estén en la carpeta 'public/videos/'
// y tengan estos nombres exactos, o cambia los nombres aquí.
const reels = [
    { id: 1, src: '/videos/reel-1.mp4', title: 'Campaña Moda' },
    { id: 2, src: '/videos/reel-2.mp4', title: 'Evento Corporativo' },
    { id: 3, src: '/videos/reel-3.mp4', title: 'Animación 3D' },
    { id: 4, src: '/videos/reel-4.mp4', title: 'Spot Publicitario' },
];

const contactUrl = "https://wa.me/51999999999?text=Hola,%20me%20interesa%20el%20servicio%20de%20Reels";
---

<Layout title="Reels - Portafolio Qoribex">
    <Navbar />

    <main class="pt-24 pb-20 bg-gray-50 min-h-screen">
        <div class="container mx-auto px-4 md:px-6 max-w-6xl">

            <!-- Encabezado -->
            <div class="text-center mb-10 animate-fade-in-up">
                <span class="bg-[#1F23A3] text-white px-4 py-1 rounded-full text-sm font-bold tracking-wider mb-4 inline-block">PORTAFOLIO</span>
                <h1 class="text-4xl md:text-6xl font-black text-[#1F23A3]">REELS & TIKTOK</h1>
                <p class="text-gray-600 mt-4 text-lg">Contenido vertical de alto impacto</p>
            </div>

            <!-- Carrusel de Videos (Responsive) -->
            <div class="w-full mb-20">
                <div class="flex flex-col items-center justify-center">
                    <!-- Contenedor principal responsive -->
                    <div class="relative w-full px-2 sm:px-4 md:px-8 lg:px-0 md:w-auto md:flex md:justify-center">

                        <!-- Marco de Celular / Contenedor -->
                        <div class="overflow-hidden rounded-3xl sm:rounded-[2rem] md:rounded-[2.5rem] border-[6px] sm:border-[8px] md:border-[10px] border-black bg-black shadow-2xl relative mx-auto" style="width: min(90vw, calc(60vh * 9 / 16)); max-width: 400px; aspect-ratio: 9/16;">
                            <div id="reels-track" class="flex transition-transform duration-500 ease-out h-full">
                                {reels.map((reel) => (
                                        <div class="w-full h-full flex-shrink-0 flex justify-center items-center bg-black relative">
                                            <video
                                                    class="w-full h-full object-cover"
                                                    controls
                                                    controlslist="nodownload"
                                                    playsinline
                                                    preload="metadata"
                                                    muted
                                                    autoplay
                                                    loop
                                            >
                                                <source src={reel.src} type="video/mp4" />
                                                Tu navegador no soporta videos HTML5.
                                            </video>

                                            <!-- Título del Reel -->
                                            <div class="absolute bottom-0 left-0 w-full p-3 sm:p-4 md:p-6 bg-gradient-to-t from-black/80 to-transparent pointer-events-none">
                                                <p class="text-white font-bold text-xs sm:text-sm md:text-base">{reel.title}</p>
                                            </div>
                                        </div>
                                ))}
                            </div>
                        </div>

                        <!-- Botones de Navegación (Dentro en móvil, fuera en desktop) -->
                        <button id="prev-reel" class="absolute hidden md:flex -left-14 top-1/2 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 rounded-full bg-white border border-gray-200 shadow-lg items-center justify-center text-[#1F23A3] hover:bg-[#1F23A3] hover:text-white transition z-10 focus:outline-none" aria-label="Anterior">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                        </button>
                        <button id="next-reel" class="absolute hidden md:flex -right-14 top-1/2 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 rounded-full bg-white border border-gray-200 shadow-lg items-center justify-center text-[#1F23A3] hover:bg-[#1F23A3] hover:text-white transition z-10 focus:outline-none" aria-label="Siguiente">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
                        </button>

                        <!-- Botones flotantes en móvil (dentro del video) -->
                        <button id="prev-reel-mobile" class="absolute md:hidden bottom-20 left-4 w-10 h-10 rounded-full bg-white/90 backdrop-blur-sm border border-gray-200 shadow-lg flex items-center justify-center text-[#1F23A3] hover:bg-[#1F23A3] hover:text-white transition z-10 focus:outline-none" aria-label="Anterior" style="top: 50%; transform: translateY(-50%);">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                        </button>
                        <button id="next-reel-mobile" class="absolute md:hidden bottom-20 right-4 w-10 h-10 rounded-full bg-white/90 backdrop-blur-sm border border-gray-200 shadow-lg flex items-center justify-center text-[#1F23A3] hover:bg-[#1F23A3] hover:text-white transition z-10 focus:outline-none" aria-label="Siguiente" style="top: 50%; transform: translateY(-50%);">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
                        </button>
                    </div>

                    <!-- Indicadores de navegación -->
                    <div class="flex justify-center gap-2 mt-6 sm:mt-8 flex-wrap">
                        {reels.map((_, index) => (
                                <button class="indicator-reel w-2 h-2 sm:w-3 sm:h-3 rounded-full bg-gray-300 hover:bg-[#1F23A3] transition-all duration-300 focus:outline-none" data-index={index} aria-label={`Ir a reel ${index + 1}`}></button>
                        ))}
                    </div>
                </div>
            </div>

            <!-- Call to Action (Estilo Claro) -->
            <div class="bg-white rounded-3xl p-8 md:p-12 text-center shadow-lg border border-gray-100 animate-fade-in-up">
                <h2 class="text-2xl md:text-4xl font-bold text-[#1F23A3] mb-8 leading-tight">
                    Potencia tu alcance con <span class="text-yellow-500">contenido viral</span>
                </h2>

                <a href={contactUrl} target="_blank" class="inline-flex items-center gap-3 bg-green-500 text-white px-8 py-4 rounded-full font-bold text-lg hover:bg-green-600 transition-all hover:scale-105 shadow-xl group">
                    <Image src={logoWa} alt="WhatsApp" class="w-6 h-6 brightness-0 invert" />
                    Contáctanos
                </a>
            </div>

        </div>
    </main>

    <footer class="bg-[#1F23A3] text-white py-10 text-center">
        <div class="container mx-auto px-4">
            <p>&copy; 2025 Qoribex Agencia Digital.</p>
        </div>
    </footer>
</Layout>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const track = document.getElementById('reels-track');
        const prevBtn = document.getElementById('prev-reel');
        const nextBtn = document.getElementById('next-reel');
        const prevBtnMobile = document.getElementById('prev-reel-mobile');
        const nextBtnMobile = document.getElementById('next-reel-mobile');
        const dots = document.querySelectorAll('.indicator-reel');

        if (track) {
            const totalItems = track.children.length;
            let currentIndex = 0;

            const updateSlider = () => {
                track.style.transform = `translateX(-${currentIndex * 100}%)`;

                // Actualizar dots
                dots.forEach((dot, idx) => {
                    if(idx === currentIndex) {
                        dot.classList.remove('bg-gray-300');
                        dot.classList.add('bg-[#1F23A3]', 'scale-125');
                    } else {
                        dot.classList.add('bg-gray-300');
                        dot.classList.remove('bg-[#1F23A3]', 'scale-125');
                    }
                });

                // Pausar todos los videos al cambiar de slide para no tener múltiples audios
                const videos = document.querySelectorAll('video');
                videos.forEach(video => video.pause());
            };

            const nextSlide = () => {
                currentIndex = (currentIndex + 1) % totalItems;
                updateSlider();
            };

            const prevSlide = () => {
                currentIndex = (currentIndex - 1 + totalItems) % totalItems;
                updateSlider();
            };

            // Botones desktop
            if (prevBtn) prevBtn.addEventListener('click', prevSlide);
            if (nextBtn) nextBtn.addEventListener('click', nextSlide);

            // Botones móvil
            if (prevBtnMobile) prevBtnMobile.addEventListener('click', prevSlide);
            if (nextBtnMobile) nextBtnMobile.addEventListener('click', nextSlide);

            // Dots navigation
            dots.forEach(dot => {
                dot.addEventListener('click', (e) => {
                    const target = e.target as HTMLElement;
                    if (target && target instanceof HTMLElement) {
                        const index = parseInt(target.getAttribute('data-index') || '0');
                        currentIndex = index;
                        updateSlider();
                    }
                });
            });

            // Soporte para navegación con teclado
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') prevSlide();
                if (e.key === 'ArrowRight') nextSlide();
            });

            // Inicializar
            updateSlider();
        }
    });
</script>